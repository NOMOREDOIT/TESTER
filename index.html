<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Image Maker Studio</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Create stunning images with Image Maker Studio, a free online editor. Easily manage layers, apply visual effects, add stylish text, and use the AI background remover. Start creating now!">
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Roboto:wght@400;700&family=DotGothic16&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <!-- The entire window and UI structure remains the same -->
    <div class="window">
        <div id="loading-overlay"><h1>Initializing Image-Maker-Studio.exe</h1></div>
        <div class="titlebar">
            <span>Image-Maker-Studio.exe</span>
            <div class="titlebar-controls">
                <button id="visuals-btn">Edit Visuals</button>
                <button id="text-btn">Text</button>
                <button id="erase-tool-btn">Erase</button>
                <button id="ai-tools-btn">BG Remover.exe</button>
                
                <button id="shortcuts-btn">Shortcuts</button>

                <button id="settings-btn" title="Settings"><i class="fas fa-cog"></i></button> 

                <div id="settings-dropdown">
                    <h5>System Settings</h5>
                    
                    <div class="settings-section">
                        <div id="storage-usage-container">
                            <div class="storage-label">
                                <i class="fas fa-hdd"></i>
                                <span>Library Storage</span>
                            </div>
                            <div id="storage-usage-display" class="storage-value">
                                Calculating...
                            </div>
                        </div>
                        <div class="settings-actions">
                            <label for="import-file-input">
                            <button id="import-library-btn" class="mg-btn" style="pointer-events: none;">Import Library</button>
                            </label>
                            <button id="export-library-btn" class="mg-btn">Export Library</button>
                        </div>
                        <button id="clear-library-btn" class="mg-btn primary" title="Permanently delete all saved projects and assets.">Clear Project Library</button>
                    </div>

                    <input type="file" id="import-file-input" accept=".json,application/json" style="display:none">
                </div>

                <div id="shortcuts-dropdown">
                    <h5>Keyboard Shortcuts</h5>
                    <ul>
                        <li><span>Undo Last Action</span><kbd>Cmd/Ctrl + Z</kbd></li>
                        <li><span>Redo Last Action</span><kbd>Cmd/Ctrl + Y</kbd></li>
                        <li><span>Enlarge Asset</span><kbd>D</kbd></li>
                        <li><span>Shrink Asset</span><kbd>F</kbd></li>
                        <li><span>Flip Asset Horizontally</span><kbd>S</kbd></li>
                        <li><span>Move Layer Forward</span><kbd>Q</kbd></li>
                        <li><span>Move Layer Backward</span><kbd>W</kbd></li>
                        <li><span>Delete Asset</span><kbd>Delete</kbd></li>
                        <li><span>Save Project</span><kbd>Cmd/Ctrl + S</kbd></li>
                    </ul>
                </div>

                <div class="controls-fake">
                    <div class="btn-square"></div>
                    <div class="btn-square"></div>
                </div>
            </div>
        </div>
        <main id="studio-container">
            <div id="controls-panel">
                <!-- All control panels remain here -->
                <div id="default-panel" class="control-panel active">
                    <fieldset id="assets-folder-fieldset">
                        <legend>Project Library</legend>
                        <button id="mg-view-all-local-assets-btn" class="mg-btn" title="Open the Project Library to see all saved projects, assets, & backgrounds">Open Library</button>
                        
                        <p style="font-size:1.1rem;margin-bottom:.5rem">Your recent assets</p>
                        <div id="mg-local-asset-palette">
                            <!-- Content will be generated by JS -->
                        </div>
                        
                        <p style="font-size:1.1rem;margin-top:.6rem;margin-bottom:.5rem">Your recent backgrounds</p>
                        <div id="mg-local-background-palette">
                            <!-- Content will be generated by JS -->
                        </div>
                    </fieldset>
                    
                    <!-- UPDATED LAYERS FIELDSET -->
                    <fieldset id="layers-fieldset" style="position: relative;">
                        <legend>Layers</legend>
                        <!-- Cleaned up button: styles are now in style.css -->
                        <button id="layer-view-toggle" title="Toggle List/Grid View">
                            <i class="fas fa-th-large"></i>
                        </button>
                        
                        <p id="layer-instructions" class="placeholder-text">Add a background to begin.</p>
                        <div id="mg-asset-palette"></div>
                    </fieldset>

                    <fieldset>
                        <legend>Project Actions</legend>
                        <div class="action-buttons" style="margin-bottom:.5rem;display:flex;gap:.5rem">
                            <button class="mg-btn" id="mg-save-project-btn" title="Save project to the Project Library (Ctrl+S)" disabled>Save Project</button>
                            <button class="mg-btn" id="mg-start-session-btn" title="Start a live collaboration session">Start Live Session</button>
                            <button class="mg-btn" id="mg-clear-canvas-btn" title="Start over with a blank canvas" disabled>Clear Canvas</button>
                        </div>
                        <button class="mg-btn generate" id="mg-download-image-btn" title="Download the final image as a PNG file" disabled>Download Image</button>
                    </fieldset>
                </div>
                <div id="visuals-panel" class="control-panel">
                    <div class="panel-header"><button class="back-button" data-target="default-panel">←</button><h5>Visuals Editor</h5></div>
                    <div id="visuals-tabs" class="eraser-mode-selector" style="margin-bottom:.8rem"><button id="visuals-tab-asset" class="visuals-main-tab-btn" type="button">Asset</button><button id="visuals-tab-background" class="visuals-main-tab-btn active" type="button">Background</button></div>
                    <div id="asset-tab-panel" class="hidden">
                        <h6>Select Layer to Edit</h6>
                        <div id="visuals-layer-palette" class="panel-layer-palette"></div>
                        <div id="asset-visuals-controls" class="disabled"><h6>Filters</h6><div class="slider-container"><label for="asset-opacity">Opacity</label><input type="range" id="asset-opacity" min="0" max="1" step=".01" value="1"></div><div class="slider-container"><label for="asset-brightness">Brightness</label><input type="range" id="asset-brightness" min="0" max="2" step=".01" value="1"></div><div class="slider-container"><label for="asset-saturation">Saturation</label><input type="range" id="asset-saturation" min="0" max="2" step=".01" value="1"><div id="feature-filters-hook"></div></div><h6>Drop Shadow</h6><div class="effects-checkbox" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem"><div><input type="checkbox" id="shadow-enable"><label for="shadow-enable">Enable</label></div><input type="color" id="shadow-color" value="#000000" style="width:100px;height:25px;border:1px solid var(--ink);padding:0"></div><div id="shadow-controls" class="effects-controls disabled"><div class="slider-container"><label for="shadow-blur">Blur</label><input type="range" id="shadow-blur" min="0" max="50" value="10"></div><div class="slider-container"><label for="shadow-offset-x">Offset X</label><input type="range" id="shadow-offset-x" min="-50" max="50" value="10"></div><div class="slider-container"><label for="shadow-offset-y">Offset Y</label><input type="range" id="shadow-offset-y" min="-50" max="50" value="10"></div></div><h6>Edge</h6><div class="effects-checkbox" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem"><div><input type="checkbox" id="asset-edge-enable"><label for="asset-edge-enable">Enable</label></div><input type="color" id="asset-edge-color" value="#FFFFFF" style="width:100px;height:25px;border:1px solid var(--ink);padding:0"></div><div id="asset-edge-controls" class="effects-controls disabled"><div class="slider-container"><label for="asset-edge-width">Width</label><input type="range" id="asset-edge-width" min="0" max="20" value="4"></div></div></div></div>
                    <div id="background-tab-panel"><div id="background-visuals-controls"><h6>Background Filters</h6><div class="slider-container"><label for="bg-brightness">Brightness</label><input type="range" id="bg-brightness" min="0" max="2" step=".01" value="1"></div><div class="slider-container"><label for="bg-saturation">Saturation</label><input type="range" id="bg-saturation" min="0" max="2" step=".01" value="1"></div></div></div>
                </div>
                <div id="eraser-panel" class="control-panel">
                    <div class="panel-header"><button class="back-button" data-target="default-panel">←</button><h5>Eraser Tool</h5></div>
                    
                    <!-- 1. Select Layer First -->
                    <h6>Select Layer to Erase</h6>
                    <div id="eraser-layer-palette" class="panel-layer-palette"></div>

                    <!-- 2. Then Choose Mode -->
                    <div class="eraser-mode-selector" style="margin-bottom: 1rem; margin-top: 0.5rem;">
                        <button class="mg-btn" id="erase-btn">Erase</button>
                        <button class="mg-btn" id="unerase-btn">Unerase</button>
                    </div>
                    
                    <!-- 3. Then Adjust Settings -->
                    <div id="eraser-controls-wrapper" class="disabled">
                        <div class="slider-container"><label for="eraser-size">Size</label><input type="range" id="eraser-size" min="5" max="250" value="128"></div>
                        <div class="slider-container"><label for="eraser-strength">Strength</label><input type="range" id="eraser-strength" min="0" max="1" step=".01" value="1"></div>
                    </div>
                </div>
                <div id="ai-tools-panel" class="control-panel">
                    <div class="panel-header"><button class="back-button" data-target="default-panel">←</button><h5>BG Remover.exe</h5></div>
                    <h6>Select Layer for Removal</h6>
                    <div id="ai-tools-layer-palette" class="panel-layer-palette"></div>
                </div>
                <div id="text-panel" class="control-panel">
                    <div class="panel-header"><button class="back-button" data-target="default-panel">←</button><h5>Text Editor</h5></div>
                    <div id="text-layer-manager"><div id="text-layer-palette"></div><button id="add-new-text-layer-btn" class="palette-slot empty" title="Add new text layer">+</button></div><div id="text-visuals-controls" class="disabled"><div class="slider-container"><label for="text-content">Text Content</label><textarea id="text-content" rows="3" style="width:100%;font-family:inherit;font-size:1rem;padding:4px;border:1px solid var(--ink);background:var(--bg);line-height:1.1">New Text</textarea></div>
                    <div class="slider-container"><label>Font</label><div id="custom-font-select"><div id="font-select-trigger" tabindex="0"><span>VT323</span> <i class="fas fa-chevron-down"></i></div><div id="font-select-dropdown" class="hidden"><ul id="font-select-list"></ul></div></div>
                    <button id="open-font-preview-btn" class="mg-btn" style="width: 100%; margin: 0.5rem 0 0 0; padding: 4px 8px; font-size: 1rem;">Visual Font Selector</button>
                    </div>
                    <div class="slider-container"><label for="text-size">Size</label><input type="range" id="text-size" min="20" max="800" step="1" value="410"></div><div class="compact-color-row"><div class="slider-container"><label for="text-color">Color</label><input type="color" id="text-color" value="#FFFFFF"></div><div class="slider-container"><label for="text-edge-color">Edge Color</label><input type="color" id="text-edge-color" value="#000000"></div></div><div class="slider-container"><label for="text-edge-width">Edge Density</label><input type="range" id="text-edge-width" min="0" max="20" step=".1" value="0"></div><h6>Drop Shadow</h6><div class="effects-checkbox" style="display:flex;justify-content:space-between;align-items:center"><div><input type="checkbox" id="text-shadow-enable"><label for="text-shadow-enable">Enable</label></div><div class="slider-container" style="margin-bottom:0;width:60%"><label for="text-shadow-color" style="margin-top:0">Color</label><input type="color" id="text-shadow-color" value="#000000" style="width:100%;border:none;padding:0"></div></div><div id="text-shadow-controls" class="effects-controls disabled"><div class="slider-container"><label for="text-shadow-blur">Blur</label><input type="range" id="text-shadow-blur" min="0" max="50" value="10"></div><div class="slider-container"><label for="text-shadow-offset-x">Offset X</label><input type="range" id="text-shadow-offset-x" min="-50" max="50" value="10"></div><div class="slider-container"><label for="text-shadow-offset-y">Offset Y</label><input type="range" id="text-shadow-offset-y" min="-50" max="50" value="10"></div></div><div id="text-zorder-controls" style="display:flex;gap:.5rem;align-items:center;margin-top:.5rem"><button id="text-move-back" class="mg-btn" type="button" style="width:auto;padding:2px 8px">Move back</button><button id="text-move-forward" class="mg-btn" type="button" style="width:auto;padding:2px 8px">Move forward</button></div>
                    </div>
                </div>
            </div>
            <div id="canvas-panel">
                <!-- ** THIS IS THE MAIN CHANGE ** -->
                <canvas id="mg-background-canvas"></canvas>
                
                <canvas id="mg-movie-canvas"></canvas>
                <canvas id="mg-controls-overlay-canvas"></canvas>
                <div id="canvas-placeholder"><img src="/welcome.png" alt="Click or drag and drop to start creating"><h3>Click, Paste, or Drag & Drop File</h3><p>to add a background image & begin creating</p></div>
            </div>
        </main>
        <footer><div class="footer-links"><a href="#"><i class="fas fa-envelope"></i>feedback</a><a href="#"><i class="fab fa-twitter"></i>updates</a><a href="#"><i class="fas fa-file-alt"></i>license</a><a href="#"><i class="fas fa-shield-alt"></i>report</a><a href="#"><i class="fas fa-lock"></i>privacy</a></div><div class="footer-right"><a href="#" id="theme-select-link"><i class="fas fa-palette"></i><span id="current-theme-name"></span></a><a href="#" id="version-link"><i class="fas fa-code-branch"></i>v4.18.1</a></div></footer>
        <input type="file" id="initial-background-input" accept="image/*" style="display:none">
    </div>

    <!-- All overlays and popups remain here -->
    <div id="mg-asset-library-overlay" class="mg-overlay-base"><div id="mg-asset-picker-wrapper" class="window"><button id="mg-asset-library-close" class="overlay-close-btn">X</button><h4>Add a New Layer</h4><p>Import an image from your device to place it on the canvas.</p><div id="mg-asset-drop-zone"><h3>Click, Paste, or Drag & Drop File</h3><p>Supported formats: PNG, JPG, JPEG</p></div><div id="mg-asset-picker-actions"><input type="file" id="mg-asset-picker-file" accept="image/png, image/jpeg" style="display:none"></div></div></div>
    <div id="project-library-popup-overlay" class="mg-overlay-base"><div id="project-library-popup" class="window"><div class="titlebar"><span>Project Library</span><button id="project-library-popup-close" class="overlay-close-btn">X</button></div><div class="library-tabs" style="padding:.5rem 1rem;display:flex;gap:.5rem;border-bottom:2px solid var(--ink)"><button id="library-tab-projects" class="visuals-main-tab-btn">Projects</button><button id="library-tab-assets" class="visuals-main-tab-btn active">Assets</button><button id="library-tab-backgrounds" class="visuals-main-tab-btn">Backgrounds</button><button id="library-tab-favorites" class="visuals-main-tab-btn">Favorites</button></div><div id="project-library-grids-container" style="flex-grow:1;overflow-y:auto"><div id="project-library-grid-projects" class="project-library-grid hidden"></div><div id="project-library-grid-assets" class="project-library-grid"></div><div id="project-library-grid-backgrounds" class="project-library-grid hidden"></div><div id="project-library-grid-favorites" class="project-library-grid hidden"></div></div></div></div>
    <div id="mg-confirmation-overlay" class="mg-overlay-base"><div id="mg-confirmation-dialog" class="window"><p id="mg-confirmation-text">Are you sure?</p><div class="action-buttons"><button id="mg-confirm-yes-btn" class="mg-btn active" type="button">Yes</button><button id="mg-confirm-no-btn" class="mg-btn" type="button">No</button></div></div></div>
    <div id="mg-asset-action-overlay" class="mg-overlay-base" style="display:none"><div id="mg-asset-action-dialog" class="window"><p>How would you like to use this asset?</p><div class="action-buttons"><button id="mg-asset-action-background-btn" class="mg-btn">Set as Background</button><button id="mg-asset-action-layer-btn" class="mg-btn">Add as Layer</button></div></div></div>
    <div id="version-popup-overlay" style="display:none"><div id="version-popup-content"><span id="close-popup">X</span><h4>v4.18.1</h4><h6>12 Sep 2025</h6><p>A performance and user experience patch focused on improving initial load times and refining UI elements based on user feedback.</p><h5>Features</h5><ul><li><strong>performance:</strong> Implemented "critical CSS" to ensure the loading screen appears almost instantly. Non-essential styles are now loaded asynchronously.</li><li><strong>performance:</strong> Decorative fonts are now loaded on-demand when the user opens the Text Editor for the first time, saving multiple network requests on initial load.</li></ul><h5>Improvements</h5><ul><li><strong>performance:</strong> Removed the background removal tool to significantly reduce the initial JavaScript bundle size.</li><li><strong>performance:</strong> Replaced the welcome video with a static, compressed PNG to speed up the placeholder view.</li><li><strong>ux:</strong> The border style selector popup is now a perfectly sized, non-scrollable grid with centered previews and improved spacing.</li><li><strong>ux:</strong> Previews in the border style selector now use the theme's main ink color (e.g., black) instead of green for better visual consistency.</li><li><strong>ui:</strong> Added small 'x' markers to the corners of the "Classic Barb" border preview to better reflect its on-canvas appearance.</li></ul><h5>Fixes</h5><ul><li><strong>style:</strong> Corrected the "Classic Wiggle" rotator handle on the canvas, which was incorrectly showing a black fill; it now correctly shows only the green stroke.</li></ul><hr style="margin:2rem 0"><h4>v4.18.0</h4><h6>11 Sep 2025</h6><p>A major update focused on UI/UX enhancements and bug fixes, particularly for the editing tools.</p><h5>Features</h5><ul><li><strong>ui:</strong> re-architected the 'Edit Visuals' dropdown into a tabbed interface ("Asset" and "Background") to improve organization and ensure it fits on smaller screens</li><li><strong>eraser:</strong> added a floating side HUD that appears when the eraser tool is active, providing quick access to primary controls without reopening the main dropdown</li><li><strong>ux:</strong> implemented a smooth "scrubbing" effect for sliders, which fades out non-essential UI elements during adjustment for better focus</li></ul><h5>Improvements</h5><ul><li><strong>style:</strong> reduced border and box-shadow thickness sitewide for a lighter, more refined aesthetic</li><li><strong>eraser:</strong> redesigned the side HUD with clear "Erase" and "Unerase" buttons that dynamically match the application's selected theme</li><li><strong>eraser:</strong> added a "Strength" slider to the side HUD for quick access to both primary brush settings</li><li><strong>eraser:</strong> refined the activation flow to keep the main dropdown open for initial adjustments; the side HUD now appears only after the user moves to the canvas</li><li><strong>ui:</strong> added smooth fade-in and fade-out transitions to the eraser's side HUD and magnifying zoom window for a more polished feel</li><li><strong>ux:</strong> the "Asset" tab in the Visuals Editor is now always clickable and provides a helpful toast message if no asset is currently selected</li><li><strong>ux:</strong> improved instructional text for the eraser, changing "Armed" to "Activated" and clarifying how to deactivate the tool</li><li><strong>text:</strong> renamed "Stroke Width" to "Density" in the Text Editor</li><li><strong>performance:</strong> capped the eraser's undo history to a maximum of 10 steps per layer to prevent excessive memory usage</li></ul><h5>Fixes</h5><ul><li><strong>download:</strong> implemented a missing `toast` function that was causing a critical error and preventing the "Download Image" button from working</li><li><strong>eraser:</strong> the floating side HUD no longer incorrectly disappears when a user interacts with its sliders</li><li><strong>eraser:</strong> the Size and Strength sliders are now perfectly synced in real-time between the main dropdown and the side HUD</li><li><strong>eraser:</strong> the side HUD now correctly disappears the moment an erase action begins (mouse-down) and reappears immediately upon release (mouse-up)</li><li><strong>ui:</strong> disabled the "scrubbing" fade-out effect for all "Strength" sliders, as hiding the UI was not necessary for that specific adjustment</li></ul></div></div>
    <div id="theme-popup-overlay" style="display:none"><div id="theme-popup-content"><ul id="theme-list"></ul></div></div>
    <div id="save-changes-overlay" class="mg-overlay-base">
        <div id="save-changes-dialog" class="window" style="padding:1.5rem;text-align:center;width:90%;max-width:450px;height:auto">
            <p id="save-changes-text" style="font-size:1.2rem;margin:0 0 1.5rem">
                You have unsaved changes. Do you want to save your current work before loading a new project?
            </p>
            <div class="action-buttons" style="display:flex;justify-content:center;gap:.5rem">
                <button id="confirm-save-continue-btn" class="mg-btn success" type="button">Save & Continue</button>
                <button id="confirm-discard-continue-btn" class="mg-btn" type="button">Discard Changes & Continue</button>
                <button id="confirm-cancel-load-btn" class="mg-btn" type="button" style="background:var(--mid)">Cancel</button>
            </div>
        </div>
    </div>
    <div id="font-preview-overlay" class="mg-overlay-base">
        <div id="font-preview-dialog" class="window" style="padding: 0; width: 90%; max-width: 1000px; height: 85vh; display: flex; flex-direction: column;">
            <div class="titlebar">
                <span>Visual Font Selector</span>
                <button id="font-preview-close-btn" class="overlay-close-btn">X</button>
            </div>
            <div id="font-preview-grid" style="flex-grow: 1; overflow-y: auto; padding: 1.5rem;">
            </div>
        </div>
    </div>
    <div id="share-session-overlay" class="mg-overlay-base">
        <div id="share-session-dialog" class="window" style="padding:1.5rem;text-align:center;width:90%;max-width:550px;height:auto">
            <button id="share-session-close-btn" class="overlay-close-btn" style="position:absolute;top:10px;right:12px">X</button>
            <h4 style="font-size:1.8rem;margin:0 0 .5rem">Live Session Started</h4>
            <p style="font-size:1.1rem;margin:0 0 1.5rem">
                Share this private link with others to collaborate in real-time. The session is end-to-end encrypted.
            </p>
            <div style="display:flex; gap: 0.5rem;">
                <input type="text" id="share-link-input" readonly style="width:100%;font-family:monospace;font-size:0.9rem;padding:8px;border:1px solid var(--ink);background:var(--bg);">
                <button id="copy-share-link-btn" class="mg-btn" style="width:auto;margin:0;white-space:nowrap;">Copy Link</button>
            </div>
        </div>
    </div>
    <div id="mg-toast"></div>
    <div id="mg-contextual-toolbar">
        <button id="toolbar-duplicate" title="Duplicate Layer">
            <i class="fas fa-copy"></i>
        </button>
        <button id="toolbar-save-asset" title="Save Asset to Library">
            <i class="fas fa-save"></i>
        </button>
        <button id="toolbar-download-asset" title="Download Asset (PNG)">
            <i class="fas fa-cloud-download-alt"></i>
        </button>
    </div>

<!-- This inline script MUST remain here -->
    <script>
        const themes = {
            'Midnight':{name:'Midnight',isDark:!0,colors:['#161618','#b0b0b0','#a8a5ff'],css:{'--bg':'#161618','--ink':'#b0b0b0','--mid':'#000000','--light':'#212121','--shadow':'#0a0a0a','--action-color':'#a8a5ff','--danger-color':'#b74545','--success-color':'#054e3c'}},
            
            'Latte': {
                name: 'Latte',
                isDark: false,
                colors: ['#F2E9DE', '#5C5450', '#8C6D5B'],
                css: {
                    '--bg': '#F2E9DE',
                    '--ink': '#5C5450',
                    '--mid': '#D4CCC5',
                    '--light': '#FAF4ED',
                    '--shadow': '#A59D96',
                    '--action-color': '#8C6D5B', // Rich Cafe Brown
                    '--danger-color': '#D95C5C',
                    '--success-color': '#2E8555'
                }
            },

            // --- FINAL "zarah" THEME: Deep Autumn Aesthetic ---
            'zarah': {
                name: 'zarah',
                isDark: true,
                colors: ['#2A211D', '#D4C8B0', '#BF6946'],
                css: {
                    '--bg': '#2A211D',
                    '--ink': '#D4C8B0', // Warmer, darker off-white for borders/text
                    '--mid': '#40352F', // Darker title bar
                    '--light': '#3B2F2A',
                    '--shadow': '#1A1411',
                    '--action-color': '#BF6946', // Muted Terracotta / Burnt Caramel
                    '--danger-color': '#C94E4E',
                    '--success-color': '#5A9E7A'
                }
            },
            
            'classic light':{name:'classic light',isDark:!1,colors:['#f2efe8','#2b2b2b','#d98c5f'],css:{'--bg':'#f2efe8','--ink':'#2b2b2b','--mid':'#c2c2c2','--light':'#faf9f5','--shadow':'#7a7a7a','--action-color':'#2b2b2b','--danger-color':'#cc4444','--success-color':'#55cc55'}},
            dark:{name:'dark',isDark:!0,colors:['#1a1d2d','#e0e5f0','#e8a85a'],css:{'--bg':'#1a1d2d','--ink':'#e0e5f0','--mid':'#3d4a6e','--light':'#252a40','--shadow':'#0d0f16','--action-color':'#e0e5f0','--danger-color':'#a83e3e','--success-color':'#4a9d4a'}},
            'イーピーイッピ':{name:'イーピーイッピ',isDark:!0,colors:['#5c3d46','#dcd0c0','#a26769'],css:{'--bg':'#2a1d21','--ink':'#dcd0c0','--mid':'#5c3d46','--light':'#402d32','--shadow':'#1a1114','--action-color':'#a26769','--danger-color':'#a26769','--success-color':'#69a267'}},
            lavender:{name:'lavender',isDark:!1,colors:['#b3b3d9','#282846','#656599'],css:{'--bg':'#b3b3d9','--ink':'#282846','--mid':'#656599','--light':'#c4c4e2','--shadow':'#47476b','--action-color':'#8c58a6'}},
            café:{name:'café',isDark:!1,colors:['#ceb18d','#4e43f','#d4d2d1'],css:{'--bg':'#ceb18d','--ink':'#4e433f','--mid':'#d4d2d1','--light':'#f7f2ea','--shadow':'#8a7a6a','--action-color':'#8a6ea2'}},
            mizu:{name:'mizu',isDark:!1,colors:['#b8dceb','#091f2c','#89a5bb'],css:{'--bg':'#b8dceb','--ink':'#091f2c','--mid':'#89a5bb','--light':'#cfe5ee','--shadow':'#627382','--action-color':'#005a8e'}},
            'キティ':{name:'キティ',isDark:!1,colors:['#fdf6e3','#657b83','#93a1a1'],css:{'--bg':'#fdf6e3','--ink':'#657b83','--mid':'#93a1a1','--light':'#eee8d5','--shadow':'#586e75','--action-color':'#268bd2'}},
            aura:{name:'aura',isDark:!0,colors:['#29423D','#EAE8E1','#C9A59C'],css:{'--bg':'#1A2A27','--ink':'#EAE8E1','--mid':'#3E5D56','--light':'#29423D','--shadow':'#111C19','--action-color':'#C9A59C','--danger-color':'#b05454','--success-color':'#5a9e7a'}}
        };
        
        !function() {
            try {
                window.themes = themes;
                const e = localStorage.getItem('selectedTheme') || 'Midnight', t = themes[e];
                if (t) {
                    const o = document.createElement('style'), s = Object.entries(t.css).map(([e, t]) => `${e}: ${t};`).join('');
                    o.textContent = `:root { ${s} }`, document.head.appendChild(o), document.body.dataset.themeName = e
                }
            } catch (e) { console.warn("Theme pre-loader failed.", e) }
        }();
    </script>
    
    <div id="mg-context-menu">
    <ul>
        <li data-action="duplicate"><i class="fas fa-copy"></i> Duplicate Layer</li>
        <li data-action="move-forward"><i class="fas fa-arrow-up"></i> Move Forward</li>
        <li data-action="move-backward"><i class="fas fa-arrow-down"></i> Move Backward</li>
        <li data-action="toggle-lock"><i class="fas fa-lock"></i> Lock Layer</li>
        <li class="separator"></li>
        <li data-action="delete" class="danger"><i class="fas fa-trash-alt"></i> Delete Layer</li>
    </ul>
</div>
    <input type="file" id="add-asset-to-library-input" accept="image/*" multiple style="display:none">
    <input type="file" id="add-bg-to-library-input" accept="image/*" multiple style="display:none">
    <script type="module" src="/main.js"></script>
    

</body>
</html>